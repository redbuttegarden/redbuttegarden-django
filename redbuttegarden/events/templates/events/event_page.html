{% extends 'base.html' %}
{% load static wagtailcore_tags wagtailimages_tags %}

{% block body_class %}
  event-page
{% endblock %}

{% block content %}
  <!-- Begin First Column -->
  <div class="row">
    <div class="col-sm-3">
      <!-- Event Picture -->
      <div class="event-pic mt-2 mt-lg-4">
        {% image page.thumbnail fill-300x300 %}
      </div>

      <div class="ev-info-header green mt-2 mt-lg-4">LOCATION:</div>
      <div class="ev-location">{{ page.location }}</div>

      <!-- Registration Info -->
      {% if page.additional_info %}
        <div class="ev-info-header green mt-2 mt-lg-4">ADDITIONAL INFO:</div>
        <div class="ev-member-sale">{{ page.additional_info|richtext }}</div>
      {% endif %}

      <!-- Instructor Info -->
      {% if page.instructor %}
        <div class="ev-info-header green mt-2 mt-lg-4">INSTRUCTOR:</div>
        <div>{{ page.instructor }}</div>
      {% endif %}

      <!-- Price Info -->
      {% if page.member_cost or page.public_cost %}
        <div class="ev-info-header green mt-2 mt-lg-4">COST:</div>
      {% endif %}

      {% if page.member_cost %}
        <div>
          <div class="inline">
            <strong>Garden Members:&nbsp;</strong>
          </div>
          <div class="ev-member-cost">{{ page.member_cost }}</div>
        </div>
      {% endif %}

      {% if page.public_cost %}
        <div>
          <div class="inline">
            <strong>General Public:&nbsp;</strong>
          </div>
          <div class="ev-public-cost">
            <span class="green fw-bold">{{ page.public_cost }}</span>
          </div>
        </div>
      {% endif %}
    </div>
    <!-- End First Column -->

    <!-- Begin Second Column -->
    <div class="col-sm-9">
      <h1 class="mt-5 mt-md-3">{{ page.title }}</h1>
      <div class="ev-sub fs-5">{{ page.sub_heading }}</div>

      <div class="ev-date fst-italic">{{ page.event_dates }}</div>

      <div class="ev-desc">
        <div>
          {% for block in page.body %}
            <div class="row">
              {% if block.block_type == 'image' %}
                {% image block.value original class='img-fluid' %}
              {% else %}
                {% include_block block %}
              {% endif %}
            </div>
          {% endfor %}

          {% for policy in page.policies.all %}
            <div class="row {% if forloop.first %}mt-5{% elif forloop.last %}mb-5{% else %}my-2{% endif %}">
              <p class="text-center">
                {% with policy_page=policy.policy_page.specific %}
                  <a href="{% pageurl policy_page %}">{{ policy.link_text }}</a>
                {% endwith %}
              </p>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block extra_js %}
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Event",

    "name": "{{ page.title|escapejs }}",

    "description": "{{ page.search_description|default:page.sub_heading|default:''|striptags|truncatechars:300|escapejs }}",

    "url": "{{ request.build_absolute_uri|escapejs }}",

    {% if page.thumbnail %}
      {% image page.thumbnail fill-1200x630 as thumb %}
      "image": [
        "{{ thumb.url|escapejs }}"
      ],
    {% endif %}

    {% if page.start_date %}
    "startDate": "{{ page.start_date|date:'c' }}",
    {% endif %}
    {% if page.end_date %}
    "endDate": "{{ page.end_date|date:'c' }}",
    {% endif %}

    "eventStatus": "https://schema.org/EventScheduled",
    "eventAttendanceMode": "https://schema.org/OfflineEventAttendanceMode",

    "location": {
      "@type": "Place",
      "name": "Red Butte Garden & Arboretum{% if page.location %} - {{ page.location|escapejs }}{% endif %}",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "300 Wakara Way",
        "addressLocality": "Salt Lake City",
        "addressRegion": "UT",
        "postalCode": "84108",
        "addressCountry": "US"
      }
    },

    "organizer": {
      "@type": "Organization",
      "name": "Red Butte Garden & Arboretum",
      "url": "https://redbuttegarden.org/"
    }

    {% if page.instructor %}
    ,
    "performer": {
      "@type": "Person",
      "name": "{{ page.instructor|escapejs }}"
    }
    {% endif %}

    {% if page.member_cost or page.public_cost %}
    ,
    "offers": [
      {% if page.member_cost %}
      {
        "@type": "Offer",
        "name": "Garden Members",
        "price": "{{ page.member_cost|striptags|escapejs }}",
        "priceCurrency": "USD"
      }{% if page.public_cost %},{% endif %}
      {% endif %}
      {% if page.public_cost %}
      {
        "@type": "Offer",
        "name": "General Public",
        "price": "{{ page.public_cost|striptags|escapejs }}",
        "priceCurrency": "USD"
      }
      {% endif %}
    ]
    {% endif %}

    {% if page.event_dates %}
    ,
    "eventSchedule": "{{ page.event_dates|striptags|escapejs }}"
    {% endif %}
  }
  </script>
{# --- /Event schema.org JSON-LD --- #}
{% endblock %}
