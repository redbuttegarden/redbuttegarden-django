{% extends 'base.html' %}
{% load static tz wagtailcore_tags wagtailimages_tags %}

{% block body_class %}
  event-page
{% endblock %}

{% block content %}
  <!-- Begin First Column -->
  <div class="row">
    <div class="col-sm-3">
      <!-- Event Picture -->
      <div class="event-pic mt-2 mt-lg-4">
        {% if page.thumbnail %}
          {% image page.thumbnail fill-300x300 %}
        {% endif %}
      </div>

      <div class="ev-info-header green mt-2 mt-lg-4">LOCATION:</div>
      <div class="ev-location">{{ page.location }}</div>

      <!-- Registration Info -->
      {% if page.additional_info %}
        <div class="ev-info-header green mt-2 mt-lg-4">ADDITIONAL INFO:</div>
        <div class="ev-member-sale">{{ page.additional_info|richtext }}</div>
      {% endif %}

      <!-- Instructor Info -->
      {% if page.instructor %}
        <div class="ev-info-header green mt-2 mt-lg-4">INSTRUCTOR:</div>
        <div>{{ page.instructor }}</div>
      {% endif %}

      <!-- Price Info: show header if any legacy or structured price is present -->
      {% if page.member_cost or page.public_cost or page.member_cost_amount or page.public_cost_amount %}
        <div class="ev-info-header green mt-2 mt-lg-4">COST:</div>
      {% endif %}

      {# Garden Members price: display legacy text, else structured numeric amount #}
      {% if page.member_cost %}
        <div>
          <div class="inline"><strong>Garden Members:&nbsp;</strong></div>
          <div class="ev-member-cost">{{ page.member_cost }}</div>
        </div>
      {% elif page.member_cost_amount is not None %}
        <div>
          <div class="inline"><strong>Garden Members:&nbsp;</strong></div>
          <div class="ev-member-cost">
            {% if page.member_cost_amount|floatformat:2 == "0.00" %}
              <span class="green fw-bold">Free</span>
            {% else %}
              <span class="green fw-bold">${{ page.member_cost_amount|floatformat:2 }}</span>
            {% endif %}
          </div>
        </div>
      {% endif %}

      {# General Public price: display legacy text, else structured numeric amount #}
      {% if page.public_cost %}
        <div>
          <div class="inline"><strong>General Public:&nbsp;</strong></div>
          <div class="ev-public-cost">
            {{ page.public_cost }}
          </div>
        </div>
      {% elif page.public_cost_amount is not None %}
        <div>
          <div class="inline"><strong>General Public:&nbsp;</strong></div>
          <div class="ev-public-cost">
            {% if page.public_cost_amount|floatformat:2 == "0.00" %}
              Free
            {% else %}
              ${{ page.public_cost_amount|floatformat:2 }}
            {% endif %}
          </div>
        </div>
      {% endif %}

    </div>
    <!-- End First Column -->

    <!-- Begin Second Column -->
    <div class="col-sm-9">
      <h1 class="mt-5 mt-md-3">{{ page.title }}</h1>
      <div class="ev-sub fs-5">{{ page.sub_heading }}</div>

      {# Display the legacy event_dates if present; otherwise show structured start/end datetimes #}
      <div class="ev-date fst-italic">
      {% if page.event_dates|default:""|length %}
        {{ page.event_dates }}
      {% elif page.start_datetime %}
        {% localtime on %}
          {# Always show date #}
          {{ page.start_datetime|date:"F j" }}
          {# Times only if editor enabled them for detail pages #}
          {% if page.display_times_on_detail %}
            {% if page.start_datetime|time %}
              · {{ page.start_datetime|time:"g:i A" }}
            {% endif %}
          {% endif %}

          {% if page.end_datetime %}
            &nbsp;–&nbsp;
            {# If end date differs from start date, show full end date #}
            {% if page.end_datetime|date:"F j, Y" != page.start_datetime|date:"F j, Y" %}
              {{ page.end_datetime|date:"F j, Y" }}
              {% if page.display_times_on_detail and page.end_datetime|time %} · {{ page.end_datetime|time:"g:i A" }}{% endif %}
            {% else %}
              {# Same day: show end time only when display_times_on_detail True #}
              {% if page.display_times_on_detail and page.end_datetime|time %}
                {{ page.end_datetime|time:"g:i A" }}
              {% endif %}
            {% endif %}
          {% endif %}
        {% endlocaltime %}
      {% endif %}
    </div>

      <div class="ev-desc">
        <div>
          {% for block in page.body %}
            <div class="row">
              {% if block.block_type == 'image' %}
                {% image block.value original class='img-fluid' %}
              {% else %}
                {% include_block block %}
              {% endif %}
            </div>
          {% endfor %}

          {% for policy in page.policies.all %}
            <div class="row {% if forloop.first %}mt-5{% elif forloop.last %}mb-5{% else %}my-2{% endif %}">
              <p class="text-center">
                {% with policy_page=policy.policy_page.specific %}
                  <a href="{% pageurl policy_page %}">{{ policy.link_text }}</a>
                {% endwith %}
              </p>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
{% endblock %}


{% block extra_js %}
<script type="application/ld+json">
{{ structured_event_json|safe }}
</script>
{% endblock %}
